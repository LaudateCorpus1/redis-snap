name: redis # you probably want to 'snapcraft register <name>'
version: '6.0' # just for humans, typically '1.2+git' or '1.3.2'
summary: Redis is used as a database, cache and message broker. # 79 char long summary
description: |
  Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. |
  It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams. |
  Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster. |
  |
  Check out https://redis.io/ for more information.

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots
base: core20

apps:
  server:
    command: usr/bin/redis-server
    daemon: simple
    restart-condition: always
    plugs:
      - network
      - network-bind
      - network-observe
      - home
  cli:
    command: usr/bin/redis-cli
    plugs:
      - network
      - network-bind
      - network-observe
      - home
  benchmark:
    command: usr/bin/redis-benchmark
    plugs:
      - network
      - network-bind
      - network-observe
      - home
  check-aof:
    command: usr/bin/redis-check-aof
    plugs:
      - network
      - network-bind
      - network-observe
      - home
  check-rdb:
    command: usr/bin/redis-check-rdb
    plugs:
      - network
      - network-bind
      - network-observe
      - home
  sentinel:
    command: usr/bin/redis-sentinel
    plugs:
      - network
      - network-bind
      - network-observe
      - home

parts:
  redis:
    plugin: make
    source-type: git
    source: https://github.com/redis/redis.git
    source-branch: $SNAPCRAFT_PROJECT_VERSION
    override-build: |
      mkdir -p ${SNAPCRAFT_PART_INSTALL}/usr
      make -j4 BUILD_TLS=yes
      PREFIX=${SNAPCRAFT_PART_INSTALL}/usr make install
    build-packages:
      - build-essential
      - libssl-dev
      - gcc
